; =============================================================================
; METRICS POOL — Dedicated PHP-FPM Pool for Dashboard Metrics
; =============================================================================
;
; PURPOSE:
;   This pool reserves 2 dedicated workers exclusively for metrics endpoints.
;   These workers cannot be starved by load test traffic on the main pool.
;
; ROUTES (configured in nginx):
;   /api/metrics/*    → port 9001 (this pool)
;   /api/health/*     → port 9001 (this pool)
;   Everything else   → port 9000 (main www pool)
;
; POOL SIZE:
;   - pm = static with 4 workers (always available)
;   - These workers are lightweight (metrics are fast reads)
;   - 4 workers handle dashboard polling + internal-probes without contention
;

; Dynamically injected by startup.sh based on www.conf settings
[metrics]

; Listen on port 9001 (main pool is on 9000)
listen = 127.0.0.1:9001

; Static pool - always keep workers ready
pm = static
pm.max_children = 4

; Status page for diagnostics (optional)
pm.status_path = /fpm-status-metrics

; Request settings
request_terminate_timeout = 30s
request_slowlog_timeout = 10s

; Logging
slowlog = /home/LogFiles/php-fpm-metrics-slow.log
catch_workers_output = yes
decorate_workers_output = no

; Security - same as main pool
security.limit_extensions = .php
